<?xml version='1.0' standalone='yes'?>
<!DOCTYPE PLUGIN [
  <!ENTITY name      "lucky">
  <!ENTITY author    "stl88083365">
  <!ENTITY version   "2024.06.03">
  <!ENTITY softver   "v1.0">
  <!ENTITY gitURL    "https://github.com/&author;/unraid-&name;/releases/download">
  <!ENTITY pluginURL "https://raw.githubusercontent.com/&author;/unraid-&name;/master/&name;.plg">
  <!ENTITY md5       "af83572206d11c7fd39253e43ea6ff3a">
  <!ENTITY plugin    "/boot/config/plugins/&name;">
  <!ENTITY emhttp    "/usr/local/emhttp/plugins/&name;">
]>

<PLUGIN  name="&name;" author="&author;" version="&version;" launch="&launch;" pluginURL="&pluginURL;" min="6.9.0-beta31">

<CHANGES>

###2024.06.03
- test

</CHANGES>

<FILE Run="/bin/bash">
<INLINE>
rm -f $(ls /boot/config/plugins/&name;/unraid-&name;*.txz 2>/dev/null|grep -v '&softver;')
</INLINE>
</FILE>

<FILE Name="/boot/config/plugins/&name;/unraid-&name;.txz" Run="upgradepkg --install-new">
<URL>&gitURL;/&softver;/unraid-&name;.txz</URL>
<MD5>&md5;</MD5>
</FILE>

<FILE Name="&emhttp;/README.md">
<INLINE>
**Mellanox Firmware Tools**

This package contains the Mellanox Firmware Tools and also shows you the current temperature and other informations about your card.
</INLINE>
</FILE>

<FILE Run="/bin/bash" Method="remove">
<INLINE>

echo "----------------------------------------"
echo "---Uninstalling Mellanox Firmware Tools---"
echo "----------------------------------------"
# Remove plugin related files
removepkg unraid-&name;
rm -rf /usr/local/emhttp/plugins/&name;
rm -rf &plugin;
echo
echo "----------------------------------------------------------------------------"
echo "------Mellanox Firmware Tools uninstalled, please reboot your server!-------"
echo "----------------------------------------------------------------------------"
echo

</INLINE>
</FILE>
</PLUGIN>
